-- Создание расширения для поддержки типа ltree
CREATE EXTENSION IF NOT EXISTS ltree;

-- Создание таблицы Catalogue
CREATE TABLE Catalogue (
    id   SMALLSERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    path LTREE
);

-- Создание таблицы Goods
CREATE TABLE Goods (
    id           SERIAL PRIMARY KEY,
    name         VARCHAR(200) NOT NULL,
    amount       INTEGER CHECK (amount >= 0),
    price        NUMERIC(10, 2) CHECK (price >= 0),
    catalogue_id SMALLINT REFERENCES Catalogue(id) ON DELETE SET NULL
);

-- Создание таблицы Clients
CREATE TABLE Clients (
    id      SERIAL PRIMARY KEY,
    name    VARCHAR(100) NOT NULL,
    address VARCHAR(200)
);

-- Создание таблицы Orders
CREATE TABLE Orders (
    id        BIGSERIAL PRIMARY KEY,
    client_id INTEGER NOT NULL REFERENCES Clients(id) ON DELETE CASCADE
);

-- Создание таблицы Ordered_goods
CREATE TABLE Ordered_goods (
    order_id BIGINT  NOT NULL REFERENCES Orders(id) ON DELETE CASCADE,
    good_id  INTEGER NOT NULL REFERENCES Goods(id) ON DELETE CASCADE,
    amount   INTEGER CHECK (amount > 0),
    PRIMARY KEY (order_id, good_id)
);

-- Заполнение таблицы Catalogue
INSERT INTO Catalogue (id, name, path) VALUES
(1, 'Бытовая техника', '1'),
(2, 'Компьютеры', '2'),
(3, 'Стиральные машины', '1.3'),
(4, 'Холодильники', '1.4'),
(5, 'однокамерные', '1.4.5'),
(6, 'двухкамерные', '1.4.6'),
(7, 'Телевизоры', '1.7'),
(8, 'Ноутбуки', '2.8'),
(9, '17''', '2.8.9'),
(10, '19''', '2.8.10'),
(11, 'Моноблоки', '2.11');

-- Обновление последовательности для Catalogue
SELECT setval('catalogue_id_seq', (SELECT MAX(id) FROM Catalogue));

-- Заполнение таблицы Goods
INSERT INTO Goods (name, amount, price, catalogue_id) VALUES
('Стиральная машина Bosch', 5, 29999.90, 3),
('Холодильник Atlant', 3, 25499.00, 4),
('Холодильник однокамерный Beko', 0, 15999.00, 5),
('Холодильник двухкамерный LG', 7, 42999.00, 6),
('Телевизор Samsung', 10, 49999.00, 7),
('Ноутбук ASUS 17"', 4, 65999.00, 9),
('Ноутбук HP 19"', 2, 72999.00, 10),
('Моноблок Apple iMac', 1, 129999.00, 11),
('Ноутбук Dell 17"', 0, 58999.00, 9),
('Стиральная машина Indesit', 8, 21999.00, 3),
('Телевизор LG', 6, 57999.00, 7),
('Холодильник Samsung', 4, 38999.00, 6),
('Ноутбук Lenovo 17"', 3, 54999.00, 9),
('Моноблок Lenovo', 2, 89999.00, 11),
('Телевизор Sony', 5, 69999.00, 7);

-- Заполнение таблицы Clients
INSERT INTO Clients (name, address) VALUES
('Иванов Иван Иванович', 'г. Москва, ул. Пушкина, д. 10'),
('Петров Петр Петрович', 'г. Санкт-Петербург, Невский пр-т, д. 25'),
('Сидорова Мария Сергеевна', 'г. Екатеринбург, ул. Ленина, д. 5'),
('Кузнецов Алексей Викторович', 'г. Новосибирск, ул. Кирова, д. 15'),
('Смирнова Ольга Владимировна', 'г. Казань, ул. Баумана, д. 8'),
('Федоров Дмитрий Николаевич', 'г. Нижний Новгород, ул. Большая Покровская, д. 12'),
('Николаева Екатерина Александровна', 'г. Ростов-на-Дону, ул. Садовая, д. 20'),
('Волков Андрей Сергеевич', 'г. Краснодар, ул. Красная, д. 15'),
('Козлова Ирина Петровна', 'г. Челябинск, ул. Кирова, д. 30'),
('Захаров Сергей Викторович', 'г. Омск, ул. Ленина, д. 45');

-- Заполнение таблицы Orders
INSERT INTO Orders (client_id) VALUES
(1), (1), (1), (1), (1), (1), (1),
(2), (2), (2), (2), (2), (2), (2), (2), (2),
(3), (3), (3),
(4), (4), (4), (4), (4), (4), (4), (4), (4), (4), (4), (4),
(5), (5), (5), (5), (5), (5), (5), (5),
(7),
(8), (8), (8), (8), (8),
(9), (9), (9), (9), (9), (9), (9), (9), (9), (9), (9), (9),
(10), (10), (10), (10), (10), (10), (10), (10), (10), (10), (10), (10);

-- Заполнение таблицы Ordered_goods
INSERT INTO Ordered_goods (order_id, good_id, amount) VALUES
-- Заказы клиента 1
(1, 1, 1), (1, 5, 1),
(2, 3, 2), (2, 7, 1),
(3, 2, 1), (3, 6, 1), (3, 10, 1),
(4, 4, 1), (4, 8, 1),
(5, 5, 2), (5, 9, 1),
(6, 1, 1), (6, 11, 1),
(7, 7, 1), (7, 12, 1),

-- Заказы клиента 2
(8, 2, 1), (8, 6, 1),
(9, 4, 2), (9, 8, 1),
(10, 1, 1), (10, 5, 1), (10, 9, 1),
(11, 3, 1), (11, 7, 1),
(12, 10, 2), (12, 14, 1),
(13, 2, 1), (13, 11, 1),
(14, 6, 1), (14, 12, 1),
(15, 4, 1), (15, 8, 2),
(16, 5, 1), (16, 13, 1), (16, 15, 1),

-- Заказы клиента 3
(17, 5, 1), (17, 11, 1),
(18, 7, 2), (18, 13, 1),
(19, 3, 1), (19, 6, 1), (19, 9, 1),

-- Заказы клиента 4
(20, 6, 1), (20, 12, 1),
(21, 8, 2), (21, 14, 1),
(22, 2, 1), (22, 5, 1), (22, 11, 1),
(23, 3, 1), (23, 7, 1),
(24, 9, 2), (24, 13, 1),
(25, 4, 1), (25, 10, 1),
(26, 6, 1), (26, 15, 1),
(27, 1, 1), (27, 8, 2),
(28, 5, 1), (28, 12, 1), (28, 14, 1),
(29, 2, 1), (29, 7, 1),
(30, 3, 1), (30, 9, 1),
(31, 4, 1), (31, 11, 1),

-- Заказы клиента 5
(32, 7, 1), (32, 13, 1),
(33, 9, 2), (33, 15, 1),
(34, 4, 1), (34, 6, 1), (34, 10, 1),
(35, 5, 1), (35, 8, 1),
(36, 11, 2), (36, 14, 1),
(37, 1, 1), (37, 12, 1),
(38, 7, 1), (38, 13, 1),
(39, 2, 1), (39, 6, 2),

-- Заказы клиента 7
(40, 9, 1), (40, 15, 1),

-- Заказы клиента 8
(41, 10, 1), (41, 15, 1),
(42, 12, 2), (42, 14, 1),
(43, 7, 1), (43, 9, 1), (43, 13, 1),
(44, 8, 1), (44, 11, 1),
(45, 15, 2), (45, 1, 1),

-- Заказы клиента 9
(46, 11, 1), (46, 13, 1),
(47, 14, 2), (47, 15, 1),
(48, 8, 1), (48, 10, 1), (48, 12, 1),
(49, 9, 1), (49, 11, 1),
(50, 13, 2), (50, 1, 1),
(51, 5, 1), (51, 15, 1),
(52, 11, 1), (52, 14, 1),
(53, 6, 1), (53, 10, 2),
(54, 12, 1), (54, 13, 1), (54, 15, 1),
(55, 7, 1), (55, 11, 1),
(56, 8, 1), (56, 14, 1),
(57, 9, 1), (57, 13, 1),

-- Заказы клиента 10
(58, 12, 1), (58, 15, 1),
(59, 13, 2), (59, 14, 1),
(60, 9, 1), (60, 11, 1), (60, 15, 1),
(61, 10, 1), (61, 12, 1),
(62, 14, 2), (62, 2, 1),
(63, 6, 1), (63, 13, 1),
(64, 12, 1), (64, 15, 1),
(65, 7, 1), (65, 11, 2),
(66, 13, 1), (66, 14, 1), (66, 1, 1),
(67, 8, 1), (67, 12, 1),
(68, 9, 1), (68, 15, 1),
(69, 10, 1), (69, 13, 1);
